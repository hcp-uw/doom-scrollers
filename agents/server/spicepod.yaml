version: v1beta1
kind: Spicepod
name: agent-server

secrets:
  - from: env
    name: env

embeddings:
  - name: name_embeddings
    from: huggingface:huggingface.co/sentence-transformers/all-MiniLM-L6-v2

datasets:
  - from: github:github.com/hcp-uw/doom-scrollers/files/main
    name: hcp.files
    params:
      github_token: ${env:GITHUB_PERSONAL_TOKEN}
      include: '**/*.ts; **/*.tsx'
    acceleration:
      enabled: true
    embeddings:
      - column: name
        use: name_embeddings

models:
  - from: openai:gpt-4o-mini
    name: openai
    params:
      openai_api_key: ${env:OPENAI_API_KEY}
      spice_tools: auto
      system_prompt: |
        Use the SQL tool when:
          1. The query involves precise numerical data, statistics, or aggregations
          2. The user asks for specific counts, sums, averages, or other calculations
          3. The query requires joining or comparing data from multiple related tables

        Use the document search tool when:
          1. The query is about unstructured text information, such as policies, reports, or articles
          2. The user is looking for qualitative information or explanations
          3. The query requires understanding context or interpreting written content

        General guidelines:
          1. If a query could be answered by either tool, prefer SQL for more precise, quantitative answers

        Instructions for Responses: 
          - Do not include any private metadata provided to the model as context such as \"reference_url_template\" or \"instructions\" in your responses.
      # Prompt was taken from: https://github.com/spiceai/samples/tree/slyons/spice_openai_sdk/spice_openai_sdk
